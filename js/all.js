(function(e){"use strict";var n=document.querySelector(".snack-bar");var t=document.querySelector(".snack-bar-msg");var o=document.querySelector(".snack-bar-action");function i(e){if(!e)return;if(n.classList.contains("show")){r()}n.classList.add("show");t.textContent=e;setTimeout(function(){r()},3e3)}function r(){n.classList.remove("show")}o.addEventListener("click",function(){r()});e.showSnackBar=i})(typeof window==="undefined"?module.exports:window);"use strict";var apiKey="428a20d6f31803d62bc3d29c0eff0937";var headerElement=document.querySelector("header");var menuIconElement=document.querySelector(".header-icon");var menuElement=document.querySelector(".menu");var menuOverlayElement=document.querySelector(".menu-overlay");var cardElement=document.querySelector(".card");function toggleSpinner(){if(spinnerElement.classList.contains("hide")){spinnerElement.classList.remove("hide")}else{spinnerElement.classList.add("hide")}}function updateNetworkStatus(){if(navigator.onLine){headerElement.classList.remove("offline")}else{headerElement.classList.add("offline");showSnackBar("offline")}}function showMenu(){menuElement.classList.add("show");menuOverlayElement.classList.add("show")}function hideMenu(){menuElement.classList.remove("show");menuOverlayElement.classList.remove("show")}menuIconElement.addEventListener("click",showMenu,false);menuOverlayElement.addEventListener("click",hideMenu,false);(function(){navigator.serviceWorker.ready.then(function(e){isPushSupported(e)});window.addEventListener("online",updateNetworkStatus,false);window.addEventListener("offline",updateNetworkStatus,false);function e(){var e="http://api.openweathermap.org/data/2.5/weather?q=Bangalore,India&appid="+apiKey;fetch(e,{method:"GET"}).then(function(e){return e.json()}).then(function(e){console.log(e);cardElement.querySelector(".card-title span").textContent=e.name+", "+e.sys.country;cardElement.querySelector(".card-wind-info span").textContent=e.wind.speed+"KM/H";cardElement.querySelector(".card-humidity-info span").textContent=e.main.humidity+"%";cardElement.querySelector(".card-max-temp span").textContent=e.main.temp_max;cardElement.querySelector(".card-min-temp span").textContent=e.main.temp_min}).catch(function(e){console.error(e)})}e()})();var notificationBtnElement=document.getElementById("turn-on-notification");var pushBtnElement=document.getElementById("send-push");var apiKey="AIzaSyCjrU5SqotSg2ybDLK_7rMMt9Rv0dMusvY";var gcmURL="https://android.googleapis.com/gcm/send";function isPushSupported(e){if(Notification.permission==="denied"){console.warn("User has blocked push notification.");return}if(!("PushManager"in window)){console.error("Push notification isn't supported in your browser.");return}e.pushManager.getSubscription().then(function(e){if(e){changePushStatus(true)}else{changePushStatus(false)}}).catch(function(e){console.error("Error occurred while enable push ",e)})}function subscribePush(){navigator.serviceWorker.ready.then(function(e){if(!e.pushManager){alert("Your browser doesn't support push notification.");return}e.pushManager.subscribe({userVisibleOnly:true}).then(function(e){console.info("Push notification subscribed.");changePushStatus(true)}).catch(function(e){console.log("Push notification subscription error: ",e)})})}function unsubscribePush(){navigator.serviceWorker.ready.then(function(e){e.pushManager.getSubscription().then(function(e){if(!e){console.error("Unable to unregister push notification.");return}e.unsubscribe().then(function(){console.info("Push notification unsubscribed.");changePushStatus(false)}).catch(function(e){console.error(e)})}).catch(function(e){console.error("Failed to unsubscribe push notification.")})})}function changePushStatus(e){notificationBtnElement.dataset.checked=e;notificationBtnElement.checked=e;if(e){pushBtnElement.removeAttribute("disabled")}else{pushBtnElement.setAttribute("disabled",true)}}notificationBtnElement.addEventListener("click",function(){var e=notificationBtnElement.dataset.checked==="true";if(e){unsubscribePush()}else{subscribePush()}});function curlCommand(e){var n=e.endpoint.split("/");var t=n[n.length-1];var o='curl --header "Authorization: key='+apiKey+'" --header Content-Type:"application/json" '+gcmURL+' -d "{\\"registration_ids\\":[\\"'+t+'\\"]}"';console.log("%c curl command to send push notification ","background: #000; color: #fff; font-size: 13px;");console.log(o)}function sendPushNotification(e){navigator.serviceWorker.ready.then(function(e){e.pushManager.getSubscription().then(function(e){curlCommand(e);fetch("/send_notification",{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)}).then(function(e){return e.json()})})})}pushBtnElement.addEventListener("click",function(){sendPushNotification()},false);